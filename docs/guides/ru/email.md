Настройка встроенного Email клиента
===================================

Чтение и отправка писем выполняется через задания в [очереди](queue.md).
Для стабильной работы почты рекомендуется использовать сервер очередей,
например, на основе Redis и ассинхронную очередь.

При этом задания на чтение почты должны поступать из cron.
Задания на отправку почты должны поступать из браузера 
при отправке письма пользователем системы.

Настройка cron
--------------

Добавьте в cron команду для регулярной проверки почты. 
Например, раз в 5 минут:

```
*/5 * * * * /usr/bin/php /var/www/iriscrm/iris iris:email:fetch
```

Каждые 5 минут будет отправляться задание на проверку почты в очередь.
Сама проверка будет выполняться из воркера.

Запуск воркеров
---------------

Для запуска воркеров и автоматического их перезапуска в случае сбоев
рекомендуется использовать [Supervisor](http://supervisord.org/).

Установка Supervisor:

```bash
sudo apt-get install supervisor
```

Конфигурации воркеров для Supervisor находится в каталоге [admin/supervisor](/admin/supervisor).
Отредактируйте и скопируйте эти конфигурации в каталог с настройками
Supervisor: `/etc/supervisor/conf.d`.

После этого обновите конфигурацию Supervisor и перезапустите воркеры:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl restart all
```

Важно!!! Не забывайте перезапустить воркеры при каждом обновлении системы.

```bash
sudo supervisorctl restart all
```
